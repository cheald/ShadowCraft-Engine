from shadowcraft.core import exceptions

class Util(object):
# This should have its own GameClass(object) architecture at some point.

    GAME_CLASS_NUMBER = {
        1:"warrior", 2:"paladin", 3:"hunter", 4:"rogue",
        5:"priest", 6:"death_knight", 7:"shaman", 8:"mage", 9:"warlock",
        10:"monk", 11:"druid", 12:"demon_hunter"
    }

    #constant scaling (for level based calculations and the like)
    CONSTANT_SCALING = [
       3.000000000000000,    3.000000000000000,    4.000000000000000,    4.000000000000000,    5.000000000000000,
       6.000000000000000,    6.000000000000000,    7.000000000000000,    7.000000000000000,    8.000000000000000,
       8.000000000000000,    9.000000000000000,    9.000000000000000,   10.000000000000000,   10.000000000000000,
      11.000000000000000,   11.000000000000000,   12.000000000000000,   12.000000000000000,   13.000000000000000,
      13.000000000000000,   14.000000000000000,   14.000000000000000,   15.000000000000000,   15.000000000000000,
      16.000000000000000,   16.000000000000000,   17.000000000000000,   17.000000000000000,   18.000000000000000,
      18.000000000000000,   19.000000000000000,   19.000000000000000,   20.000000000000000,   20.000000000000000,
      21.000000000000000,   21.000000000000000,   22.000000000000000,   22.000000000000000,   23.000000000000000,
      23.000000000000000,   24.000000000000000,   24.000000000000000,   25.000000000000000,   25.000000000000000,
      26.000000000000000,   26.000000000000000,   27.000000000000000,   27.000000000000000,   28.000000000000000,
      28.000000000000000,   29.000000000000000,   29.000000000000000,   30.000000000000000,   30.000000000000000,
      31.000000000000000,   31.000000000000000,   32.000000000000000,   32.000000000000000,   33.000000000000000,
      35.000000000000000,   37.000000000000000,   39.000000000000000,   39.000000000000000,   40.000000000000000,
      40.000000000000000,   41.000000000000000,   41.000000000000000,   42.000000000000000,   43.000000000000000,
      45.000000000000000,   47.000000000000000,   49.000000000000000,   49.000000000000000,   50.000000000000000,
      50.000000000000000,   51.000000000000000,   51.000000000000000,   52.000000000000000,   52.000000000000000,
      54.000000000000000,   56.000000000000000,   57.000000000000000,   57.000000000000000,   58.000000000000000,
      60.000000000000000,   63.000000000000000,   65.000000000000000,   66.000000000000000,   67.000000000000000,
     101.000000000000000,  118.000000000000000,  139.000000000000000,  162.000000000000000,  190.000000000000000,
     225.000000000000000,  234.000000000000000,  242.000000000000000,  252.000000000000000,  261.000000000000000,
     261.000000000000000,  261.000000000000000,  261.000000000000000,  261.000000000000000,  261.000000000000000,
     261.000000000000000,  261.000000000000000,  261.000000000000000,  261.000000000000000,  261.000000000000000,
    ]

    #Base armor values for enemy level
    #Source: http://blue.mmo-champion.com/topic/409203-theorycrafting-questions/#post109
    BASE_ARMOR = {100: 1536.,
    101: 2313.,
    102: 2388.,
    103: 2467.,
    104: 2550.,
    105: 2638.,
    106: 2729.,
    107: 2826.,
    108: 2927.,
    109: 3035.,
    110: 3144.,
    111: 3254.,
    112: 3364.,
    113: 3474.,
    }

    #K value for armor mitigation computation
    #Source: http://blue.mmo-champion.com/topic/409203-theorycrafting-questions/#post46
    ATTACKER_K_VALUE = {100: 3610.,
    101: 3973.,
    102: 4373.,
    103: 4812.,
    104: 5296.,
    105: 5829.,
    106: 6415.,
    107: 6642.,
    108: 6880.,
    109: 7132.,
    110: 7390.,
    111: 7648.,
    112: 7906.,
    113: 8164.,
    }

    #SimC keeps their enchant scale data here: https://code.google.com/p/simulationcraft/source/browse/engine/dbc/sc_scale_data.inc#342
    #these, however, are the trinket scale data
    RANDOM_PROP_POINTS = [
      [0,0],
      [1,0],
      [2,0],
      [3,0],
      [4,0],
      [5,0],
      [6,0],
      [7,0],
      [8,0],
      [9,0],
      [10,9],
      [11,10],
      [12,10],
      [13,11],
      [14,11],
      [15,12],
      [16,12],
      [17,13],
      [18,13],
      [19,14],
      [20,14],
      [21,15],
      [22,15],
      [23,16],
      [24,16],
      [25,17],
      [26,17],
      [27,18],
      [28,18],
      [29,19],
      [30,19],
      [31,20],
      [32,20],
      [33,21],
      [34,21],
      [35,22],
      [36,22],
      [37,23],
      [38,23],
      [39,24],
      [40,24],
      [41,25],
      [42,25],
      [43,26],
      [44,26],
      [45,27],
      [46,27],
      [47,28],
      [48,28],
      [49,29],
      [50,29],
      [51,30],
      [52,30],
      [53,31],
      [54,31],
      [55,32],
      [56,32],
      [57,33],
      [58,33],
      [59,34],
      [60,34],
      [61,35],
      [62,35],
      [63,36],
      [64,36],
      [65,37],
      [66,37],
      [67,37],
      [68,37],
      [69,37],
      [70,37],
      [71,37],
      [72,37],
      [73,37],
      [74,37],
      [75,37],
      [76,37],
      [77,37],
      [78,37],
      [79,37],
      [80,37],
      [81,37],
      [82,37],
      [83,37],
      [84,37],
      [85,37],
      [86,37],
      [87,37],
      [88,37],
      [89,37],
      [90,37],
      [91,37],
      [92,37],
      [93,37],
      [94,38],
      [95,38],
      [96,39],
      [97,39],
      [98,40],
      [99,40],
      [100,40],
      [101,41],
      [102,41],
      [103,42],
      [104,42],
      [105,43],
      [106,43],
      [107,44],
      [108,44],
      [109,44],
      [110,45],
      [111,45],
      [112,46],
      [113,46],
      [114,47],
      [115,47],
      [116,47],
      [117,47],
      [118,47],
      [119,47],
      [120,47],
      [121,47],
      [122,47],
      [123,47],
      [124,47],
      [125,47],
      [126,47],
      [127,47],
      [128,47],
      [129,47],
      [130,47],
      [131,47],
      [132,47],
      [133,47],
      [134,47],
      [135,47],
      [136,47],
      [137,47],
      [138,47],
      [139,47],
      [140,47],
      [141,47],
      [142,47],
      [143,47],
      [144,47],
      [145,47],
      [146,47],
      [147,47],
      [148,47],
      [149,47],
      [150,47],
      [151,47],
      [152,47],
      [153,47],
      [154,47],
      [155,47],
      [156,47],
      [157,47],
      [158,47],
      [159,47],
      [160,47],
      [161,47],
      [162,47],
      [163,47],
      [164,47],
      [165,47],
      [166,48],
      [167,48],
      [168,48],
      [169,48],
      [170,48],
      [171,48],
      [172,48],
      [173,49],
      [174,49],
      [175,49],
      [176,49],
      [177,49],
      [178,49],
      [179,49],
      [180,50],
      [181,50],
      [182,50],
      [183,50],
      [184,50],
      [185,50],
      [186,50],
      [187,51],
      [188,51],
      [189,51],
      [190,51],
      [191,51],
      [192,51],
      [193,51],
      [194,52],
      [195,52],
      [196,52],
      [197,52],
      [198,52],
      [199,52],
      [200,52],
      [201,53],
      [202,53],
      [203,53],
      [204,53],
      [205,53],
      [206,53],
      [207,54],
      [208,54],
      [209,54],
      [210,54],
      [211,54],
      [212,54],
      [213,55],
      [214,55],
      [215,55],
      [216,55],
      [217,55],
      [218,55],
      [219,55],
      [220,55],
      [221,55],
      [222,55],
      [223,55],
      [224,55],
      [225,55],
      [226,55],
      [227,55],
      [228,55],
      [229,55],
      [230,55],
      [231,55],
      [232,55],
      [233,55],
      [234,55],
      [235,55],
      [236,55],
      [237,55],
      [238,55],
      [239,55],
      [240,55],
      [241,55],
      [242,55],
      [243,55],
      [244,55],
      [245,55],
      [246,55],
      [247,55],
      [248,55],
      [249,55],
      [250,55],
      [251,55],
      [252,55],
      [253,55],
      [254,55],
      [255,55],
      [256,55],
      [257,55],
      [258,55],
      [259,55],
      [260,55],
      [261,55],
      [262,55],
      [263,55],
      [264,55],
      [265,55],
      [266,55],
      [267,55],
      [268,55],
      [269,55],
      [270,55],
      [271,55],
      [272,55],
      [273,55],
      [274,55],
      [275,55],
      [276,55],
      [277,55],
      [278,55],
      [279,55],
      [280,55],
      [281,55],
      [282,55],
      [283,55],
      [284,55],
      [285,55],
      [286,55],
      [287,55],
      [288,55],
      [289,55],
      [290,55],
      [291,56],
      [292,56],
      [293,56],
      [294,56],
      [295,56],
      [296,56],
      [297,56],
      [298,56],
      [299,56],
      [300,56],
      [301,56],
      [302,56],
      [303,56],
      [304,56],
      [305,57],
      [306,57],
      [307,57],
      [308,57],
      [309,57],
      [310,57],
      [311,57],
      [312,57],
      [313,57],
      [314,57],
      [315,57],
      [316,57],
      [317,57],
      [318,57],
      [319,58],
      [320,58],
      [321,58],
      [322,58],
      [323,58],
      [324,58],
      [325,58],
      [326,58],
      [327,58],
      [328,58],
      [329,58],
      [330,58],
      [331,58],
      [332,59],
      [333,59],
      [334,59],
      [335,59],
      [336,59],
      [337,59],
      [338,59],
      [339,59],
      [340,59],
      [341,59],
      [342,59],
      [343,59],
      [344,59],
      [345,59],
      [346,60],
      [347,60],
      [348,60],
      [349,60],
      [350,60],
      [351,60],
      [352,60],
      [353,60],
      [354,60],
      [355,60],
      [356,60],
      [357,60],
      [358,60],
      [359,61],
      [360,61],
      [361,61],
      [362,61],
      [363,61],
      [364,61],
      [365,61],
      [366,61],
      [367,61],
      [368,61],
      [369,61],
      [370,61],
      [371,61],
      [372,61],
      [373,61],
      [374,61],
      [375,61],
      [376,61],
      [377,61],
      [378,61],
      [379,61],
      [380,61],
      [381,61],
      [382,61],
      [383,61],
      [384,61],
      [385,61],
      [386,61],
      [387,61],
      [388,61],
      [389,61],
      [390,61],
      [391,61],
      [392,61],
      [393,61],
      [394,61],
      [395,61],
      [396,61],
      [397,61],
      [398,61],
      [399,61],
      [400,61],
      [401,61],
      [402,61],
      [403,61],
      [404,61],
      [405,61],
      [406,61],
      [407,61],
      [408,61],
      [409,61],
      [410,61],
      [411,61],
      [412,61],
      [413,61],
      [414,61],
      [415,61],
      [416,61],
      [417,61],
      [418,62],
      [419,62],
      [420,62],
      [421,62],
      [422,62],
      [423,62],
      [424,62],
      [425,62],
      [426,62],
      [427,62],
      [428,62],
      [429,62],
      [430,62],
      [431,62],
      [432,62],
      [433,62],
      [434,62],
      [435,63],
      [436,63],
      [437,63],
      [438,63],
      [439,63],
      [440,63],
      [441,63],
      [442,63],
      [443,63],
      [444,64],
      [445,64],
      [446,64],
      [447,64],
      [448,64],
      [449,64],
      [450,65],
      [451,65],
      [452,65],
      [453,65],
      [454,65],
      [455,65],
      [456,65],
      [457,66],
      [458,66],
      [459,66],
      [460,66],
      [461,66],
      [462,66],
      [463,67],
      [464,68],
      [465,68],
      [466,69],
      [467,70],
      [468,70],
      [469,71],
      [470,72],
      [471,72],
      [472,73],
      [473,74],
      [474,74],
      [475,75],
      [476,76],
      [477,76],
      [478,77],
      [479,78],
      [480,78],
      [481,79],
      [482,80],
      [483,81],
      [484,81],
      [485,82],
      [486,83],
      [487,84],
      [488,85],
      [489,85],
      [490,86],
      [491,87],
      [492,88],
      [493,89],
      [494,89],
      [495,90],
      [496,91],
      [497,92],
      [498,93],
      [499,94],
      [500,95],
      [501,95],
      [502,96],
      [503,97],
      [504,98],
      [505,99],
      [506,100],
      [507,101],
      [508,102],
      [509,103],
      [510,104],
      [511,105],
      [512,106],
      [513,107],
      [514,108],
      [515,109],
      [516,110],
      [517,111],
      [518,112],
      [519,113],
      [520,114],
      [521,115],
      [522,116],
      [523,117],
      [524,118],
      [525,119],
      [526,121],
      [527,122],
      [528,123],
      [529,124],
      [530,125],
      [531,126],
      [532,127],
      [533,129],
      [534,130],
      [535,131],
      [536,132],
      [537,134],
      [538,135],
      [539,136],
      [540,137],
      [541,139],
      [542,140],
      [543,141],
      [544,143],
      [545,144],
      [546,145],
      [547,147],
      [548,148],
      [549,149],
      [550,151],
      [551,152],
      [552,154],
      [553,155],
      [554,156],
      [555,158],
      [556,159],
      [557,161],
      [558,162],
      [559,164],
      [560,165],
      [561,167],
      [562,169],
      [563,170],
      [564,172],
      [565,173],
      [566,175],
      [567,177],
      [568,178],
      [569,180],
      [570,182],
      [571,183],
      [572,185],
      [573,187],
      [574,188],
      [575,190],
      [576,192],
      [577,194],
      [578,196],
      [579,197],
      [580,199],
      [581,201],
      [582,203],
      [583,205],
      [584,207],
      [585,209],
      [586,211],
      [587,213],
      [588,215],
      [589,217],
      [590,219],
      [591,221],
      [592,223],
      [593,225],
      [594,227],
      [595,229],
      [596,231],
      [597,234],
      [598,236],
      [599,238],
      [600,240],
      [601,242],
      [602,245],
      [603,247],
      [604,249],
      [605,252],
      [606,254],
      [607,256],
      [608,259],
      [609,261],
      [610,264],
      [611,266],
      [612,269],
      [613,271],
      [614,274],
      [615,276],
      [616,279],
      [617,281],
      [618,284],
      [619,287],
      [620,289],
      [621,292],
      [622,295],
      [623,298],
      [624,300],
      [625,303],
      [626,306],
      [627,309],
      [628,312],
      [629,315],
      [630,318],
      [631,321],
      [632,324],
      [633,327],
      [634,330],
      [635,333],
      [636,336],
      [637,339],
      [638,342],
      [639,345],
      [640,349],
      [641,352],
      [642,355],
      [643,358],
      [644,362],
      [645,365],
      [646,369],
      [647,372],
      [648,376],
      [649,379],
      [650,383],
      [651,386],
      [652,390],
      [653,393],
      [654,397],
      [655,401],
      [656,405],
      [657,408],
      [658,412],
      [659,416],
      [660,420],
      [661,424],
      [662,428],
      [663,432],
      [664,436],
      [665,440],
      [666,444],
      [667,448],
      [668,452],
      [669,457],
      [670,461],
      [671,465],
      [672,470],
      [673,474],
      [674,479],
      [675,483],
      [676,488],
      [677,492],
      [678,497],
      [679,501],
      [680,506],
      [681,511],
      [682,516],
      [683,520],
      [684,525],
      [685,530],
      [686,535],
      [687,540],
      [688,545],
      [689,550],
      [690,555],
      [691,561],
      [692,566],
      [693,571],
      [694,577],
      [695,582],
      [696,587],
      [697,593],
      [698,598],
      [699,604],
      [700,610],
      [701,615],
      [702,621],
      [703,627],
      [704,633],
      [705,639],
      [706,645],
      [707,651],
      [708,657],
      [709,663],
      [710,669],
      [711,675],
      [712,682],
      [713,688],
      [714,695],
      [715,701],
      [716,708],
      [717,714],
      [718,721],
      [719,728],
      [720,735],
      [721,741],
      [722,748],
      [723,755],
      [724,762],
      [725,770],
      [726,777],
      [727,784],
      [728,791],
      [729,799],
      [730,806],
      [731,814],
      [732,821],
      [733,829],
      [734,837],
      [735,845],
      [736,853],
      [737,861],
      [738,869],
      [739,877],
      [740,885],
      [741,893],
      [742,902],
      [743,910],
      [744,919],
      [745,927],
      [746,936],
      [747,945],
      [748,954],
      [749,962],
      [750,971],
      [751,981],
      [752,990],
      [753,999],
      [754,1008],
      [755,1018],
      [756,1027],
      [757,1037],
      [758,1047],
      [759,1056],
      [760,1066],
      [761,1076],
      [762,1086],
      [763,1097],
      [764,1107],
      [765,1117],
      [766,1128],
      [767,1138],
      [768,1149],
      [769,1160],
      [770,1170],
      [771,1181],
      [772,1192],
      [773,1204],
      [774,1215],
      [775,1226],
      [776,1238],
      [777,1249],
      [778,1261],
      [779,1273],
      [780,1285],
      [781,1297],
      [782,1309],
      [783,1321],
      [784,1334],
      [785,1346],
      [786,1359],
      [787,1371],
      [788,1384],
      [789,1397],
      [790,1410],
      [791,1423],
      [792,1437],
      [793,1450],
      [794,1464],
      [795,1477],
      [796,1491],
      [797,1505],
      [798,1519],
      [799,1534],
      [800,1548],
      [801,1562],
      [802,1577],
      [803,1592],
      [804,1607],
      [805,1622],
      [806,1637],
      [807,1652],
      [808,1668],
      [809,1683],
      [810,1699],
      [811,1715],
      [812,1731],
      [813,1747],
      [814,1764],
      [815,1780],
      [816,1797],
      [817,1814],
      [818,1831],
      [819,1848],
      [820,1865],
      [821,1882],
      [822,1900],
      [823,1918],
      [824,1936],
      [825,1954],
      [826,1972],
      [827,1991],
      [828,2009],
      [829,2028],
      [830,2047],
      [831,2066],
      [832,2086],
      [833,2105],
      [834,2125],
      [835,2145],
      [836,2165],
      [837,2185],
      [838,2206],
      [839,2226],
      [840,2247],
      [841,2268],
      [842,2289],
      [843,2311],
      [844,2332],
      [845,2354],
      [846,2376],
      [847,2398],
      [848,2421],
      [849,2444],
      [850,2466],
      [851,2490],
      [852,2513],
      [853,2536],
      [854,2560],
      [855,2584],
      [856,2608],
      [857,2633],
      [858,2657],
      [859,2682],
      [860,2707],
      [861,2733],
      [862,2758],
      [863,2784],
      [864,2810],
      [865,2836],
      [866,2863],
      [867,2890],
      [868,2917],
      [869,2944],
      [870,2972],
      [871,3000],
      [872,3028],
      [873,3056],
      [874,3085],
      [875,3113],
      [876,3143],
      [877,3172],
      [878,3202],
      [879,3232],
      [880,3262],
      [881,3292],
      [882,3323],
      [883,3354],
      [884,3386],
      [885,3417],
      [886,3449],
      [887,3482],
      [888,3514],
      [889,3547],
      [890,3580],
      [891,3614],
      [892,3648],
      [893,3682],
      [894,3716],
      [895,3751],
      [896,3786],
      [897,3822],
      [898,3858],
      [899,3894],
      [900,3930],
      [901,3967],
      [902,4004],
      [903,4042],
      [904,4079],
      [905,4118],
      [906,4156],
      [907,4195],
      [908,4234],
      [909,4274],
      [910,4314],
      [911,4354],
      [912,4395],
      [913,4436],
      [914,4478],
      [915,4520],
      [916,4562],
      [917,4605],
      [918,4648],
      [919,4691],
      [920,4735],
      [921,4779],
      [922,4824],
      [923,4869],
      [924,4915],
      [925,4961],
      [926,5007],
      [927,5054],
      [928,5102],
      [929,5149],
      [930,5198],
      [931,5246],
      [932,5295],
      [933,5345],
      [934,5395],
      [935,5445],
      [936,5496],
      [937,5548],
      [938,5600],
      [939,5652],
      [940,5705],
      [941,5759],
      [942,5812],
      [943,5867],
      [944,5922],
      [945,5977],
      [946,6033],
      [947,6090],
      [948,6147],
      [949,6204],
      [950,6262],
      [951,6321],
      [952,6380],
      [953,6440],
      [954,6500],
      [955,6561],
      [956,6622],
      [957,6684],
      [958,6747],
      [959,6810],
      [960,6874],
      [961,6938],
      [962,7003],
      [963,7069],
      [964,7135],
      [965,7202],
      [966,7269],
      [967,7337],
      [968,7406],
      [969,7475],
      [970,7545],
      [971,7616],
      [972,7687],
      [973,7759],
      [974,7832],
      [975,7905],
      [976,7979],
      [977,8054],
      [978,8129],
      [979,8205],
      [980,8282],
      [981,8359],
      [982,8438],
      [983,8517],
      [984,8596],
      [985,8677],
      [986,8758],
      [987,8840],
      [988,8923],
      [989,9006],
      [990,9091],
      [991,9176],
      [992,9262],
      [993,9348],
      [994,9436],
      [995,9524],
      [996,9613],
      [997,9703],
      [998,9794],
      [999,9886],
      [1000,9978],
    ]

    def get_class_number(self, game_class):
        for i in self.GAME_CLASS_NUMBER.keys():
            if self.GAME_CLASS_NUMBER[i] == game_class:
                return i
        raise exceptions.InvalidInputException(_('{game_class} is not a supported game class').format(game_class=game_class))

    def get_random_prop_point(self, item_level):
        if item_level < 1:
            raise exceptions.InvalidInputException(_('item_level={item_level} need to be >= 1').format(item_level=item_level))
        return self.RANDOM_PROP_POINTS[item_level][1]

    def get_constant_scaling_point(self, level):
        return self.CONSTANT_SCALING[level-1]

    def get_base_armor(self, level):
        if level < 100:
            raise exceptions.InvalidInputException(_('There\'s no armor value for a target level {level}').format(level=str(level)))
        return self.BASE_ARMOR[level]

    def get_k_value(self, level):
        if level < 100:
            raise exceptions.InvalidInputException(_('There\'s no k value for a level {level} player').format(level=str(level)))
        return self.ATTACKER_K_VALUE[level]